# 함수형 프로그래밍이란

- 부수 효과(side effect): 함수가 리턴값 이외에 하는 모든 일.
- 순수 함수(pure function, 또는 수학 함수): 인자에만 의존하고 부수 효과가 없는 함수. 같은 인자를 넣으면 항상 같은 결과값

일반적인 함수형 프로그래밍의 정의는 “수학 함수를 사용하고 부수 효과를 피하는 것이 특징인 프로그래밍 패러다임”. 하지만 이 정의는 실용적인 측면에서 3가지 문제점 존재한다.

### 부수 효과는 필요하다.

부수 효과는 소프트웨어를 실행하는 이유다.(이메일 보내기, 파일 읽기, 웹 요청하기…) 필요할 때는 써야 한다.

### 함수형 프로그래밍은 부수 효과를 잘 다룰 수 있다.

함수형 프로그래머는 순수하지 않은 함수를 잘 다룰 수 있는 기술이 많다.

### 함수형 프로그래밍은 실용적이다.

실제 소프트웨어 개발에서도 잘 사용 되고 있다.

# 액션, 계산, 데이터의 구분

함수형 프로그래머는 코드를 액션과 계산, 데이터로 구분한다.

- 액션: 호출하는 횟수나 호출하는 시점에 의존
- 계산: 입력값으로 출력값을 만드는 것. 언제 어디서 계산해도 결과는 같고 외부에 영향을 주지 않음.
- 데이터: 이벤트에 대해 기록한 사실

### 구분 시 장점

코드를 데이터와 계산으로 바꿀수록 **분산 시스템의 불확실성**에 대응하기 좋다.

- 분산 시스템의 규칙 3가지
    1. 메시지 순서가 바뀔 수 있다.
    2. 메시지는 한 번 이상 도착할 수도 있고 도착하지 않을 수도 있다.
    3. 응답을 받지 못하면 무슨 일이 생겼는지 알 수 없다.

---

# 계층화 설계 - 변경 가능성에 따라 코드 나누기

자주 바뀌지 않는 것은 가장 아래, 자주 바뀌는 것은 가장 위쪽 계층으로 둔다.

각 계층은 그 아래에 있는 계층을 기반으로 만들어진다.

계층형 설계는 일반적으로 **비즈니스 규칙, 도메인 규칙, 기술 스택 계층**으로 나눌 수 있다.

⇒ 테스트, 재사용, 유지보수가 쉬워진다.

# 타임라인 다이어그램

**타임라인 다이어그램은 시간에 따라 변하는 액션을 시각화하는 방법**이다.

액션은 실행시점에 의존하기 때문에 실행 순서가 중요하다.

분산 시스템을 도입하면 각 시스템이 각자의 타임라인을 가지고 일을 하게 된다.

**⇒ 타임라인을 서로 맞추지 않은 분산 시스템은 예측 불가능한 순서로 실행된다.**

그러면 어떻게 개선해야 할까?

## 타임라인 커팅

**타임라인 커팅은 고차동작(고차 함수로 만든 동작)으로 구현**한다.

각 타임라인은 독립적으로 동작하고 작업이 완료되면 다른 타임라인이 끝나기를 기다린다.

⇒ 액션이 올바른 순서로 실행할 수 있도록 보장해준다.

- 타임라인 커팅으로 서로 다른 작업들을 쉽게 이해할 수 있다
    - 커팅을 통해 순서대로 해야하는 작업(반죽펴기→ 소스 바르기..)과 그러지 않은 작업(반죽 만들기, 치즈 갈기…)을 분리 할 수 있었다.
- 타임라인 다이어그램을 사용하면 시간에 따라 진행하는 작업을 쉽게 이해할 수 있다.
    - 동시에 실행되는 분산 시스템을 시각화하기 좋다.
- 타임라인 다이어그램은 유연하다.

---

# 장보기 과정 예제

“필요한 것을 구입하기”라는 액션에서 데이터와 계산을 나눌 수 있다.

- 데이터: 현재 재고, 필요한 재고, 장보기 목록
- 계산: 재고 빼기(필요한 재고 - 현재 재고 = 장보기 목록)

1. 액션과 계산, 데이터는 어디에나 적용할 수 있다.
2. 액션 안에는 계산과 데이터, 또 다른 액션이 숨어 있을 수 있다.
    1. 나누고 나누는 것을 언제 멈춰야 할 지 아는 것이 중요하다.
3. 계산은 더 작은 계산과 데이터로 나누고 연결 할 수 있다.
4. 데이터는 데이터만 조합할 수 있다.
    1. 데이터는 다른 영향을 주지 않으므로 데이터 찾는 일을 먼저 해야한다.
5. 계산은 때로 ‘우리 머릿속에서’ 일어난다.
    1. 계산은 우리 사고과정에 녹아있기 때문에 발견하기 쉽지 않다. 결정과 계획은 계산이 될 가능성이 높다.

## 📍데이터

- 데이터는 이벤트에 대한 사실. 일어난 일의 결과를 기록한 것
- 데이터 구조로 의미를 담을 수 있다. ex) 목록의 순서가 중요하면 순서를 보장하는 데이터 구조 사용
- 불변성 - 불변 데이터 구조를 만들기 위한 2가지 원칙 사용하기
    1. **카피-온-라이트**: 변경할 때 복사본 만들기
    2. **방어적 복사**: 보관하려고 하는 데이터의 복사본을 만들기
- 데이터의 장점
    1. **직렬화**: 직렬화된 데이터는 전송하거나 디스크에 저장했다가 읽기 쉽다.
    2. **동일성 비교**: 데이터간 비교는 쉽다.
    3. **자유로운 해석**: 여러가지 방법으로 해석이 가능하다. ex) 접속 로그 - 문제해결, 모니터링 등
- 데이터의 단점
    - 유연하게 해석이 가능하지만 해석이 반드시 필요하다는 것이 단점. 해석하지 않은 데이터는 쓸모없다.

⇒ 데이터를 언제나 쉽게 해석할 수 있도록 표현하자.

## 📍 계산

- 계산은 입력값으로 출력값을 만드는 것. 실행 시점과 횟수와 관계없이 항상 같은 입력값에 대해 같은 출력값.
- 함수로 구현. 계산에는 연산을 담을 수 있다.
- 왜 액션보다 계산이 좋을까?
    1. **테스트**하기 쉽다.
    2. 기계적인 분석이 쉽다. (정적분석: 소스 코드의 실행 없이 정적으로 프로그램의 문제를 찾는 과정)
    3. 조합하기 좋다.
- 계산을 쓰면서 걱정하지 않아도 되는 부분
    1. 동시에 실행되는 것
    2. 과거에 실행되었던 것이나 미래에 실행할 것
    3. 실행 횟수
- 계산의 단점
    - 실행하기 전에 어떤 일이 발생할지 알 수 없다.
    - 소프트웨어 측면에서 함수는 블랙박스
    - 이런 단점이 싫다면 계산이나 액션 대신 데이터를 사용

## 📍액션

- 액션은 외부세계에 영향을 주거나 받는 것. 실행 시점과 횟수에 의존한다.
- 함수로 구현
- 액션은 코드 전체로 퍼진다
    - 액션을 부르는 함수가 있다면 그 함수도 액션이 된다.
- 액션은 다양한 형태로 나타난다. 예시는 JS
    - **함수&메서드 호출**: alert, console.log
    - **생성자**: new Date()
    - **표현식**: 변수참조, 속성 참조, 배열참조
    - **상태**: 값 할당, 속성 삭제
- 액션이 외부 세상에 어떤 영향을 주려고 하는지, 하려고 하는 일을 아는 것이 중요하다.
- 액션을 잘 사용하려면?
    1. 가능한 액션을 적게 사용한다. 전혀 쓰지 않을 수는 없다.
    2. 액션을 가능한 작게 만든다.
    3. 외부 세계와 상호작용하는 것을 제한한다.
    4. 액션이 호출시점에 의존하는 것을 제한한다.

---

# 마치며 💭

자연스럽게 액션/계산/데이터를 나누어보며 코드를 읽는 것이 중요할 것 같다.

개발을 하다보면 굳이 이것도 분리해야 할까 싶어서 계산을 액션 코드에 함께 합치는 경우가 많았던 거 같다. 어디까지 고려하면서 분리를 하는 것이 좋을지 궁금하다.
